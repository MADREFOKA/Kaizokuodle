<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adivina los Datos - Kaizoku Quiz</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="https://www.icons101.com/icons/93/Token_Anime_Pack_by_Erehr/128/One%20Piece.PNG">
</head>
<body>
  <div class="datos-container">
    <img src="https://logos-world.net/wp-content/uploads/2021/09/One-Piece-Logo-1999.png" 
         alt="One Piece" 
         width="400" 
         height="200" 
         style="max-width: 100%; height: auto;">
    
    <h1 class="menu-title">Adivina los Datos del Personaje</h1>

    <div id="personaje-actual" class="datos-personaje"></div>

    <form id="form-datos" class="datos-form"></form>

    <div class="datos-botones">
      <button type="button" class="btn-opciones" id="btn-comprobar">Comprobar</button>
      <button type="button" class="btn-opciones" id="btn-nuevo">Nuevo personaje</button>
      <button type="button" class="btn-opciones" onclick="location.href='index.html'">ðŸ”™ Volver al menÃº</button>
    </div>

    <div id="mensaje-final" class="hl-mensaje"></div>
  </div>

  <script>
    // === CONFIGURACIÃ“N SHEETS ===
    const sheetID = '1OJVVupqt0UJTB8QJKLH_UNYYaWtY41ekqpZBSlpFdxQ';
    const apiKey = 'AIzaSyAiIS758bKjVHSvAN9Ub__7dSQOWbWSLfQ';
    const sheetName = 'FÃ¡cil';

    const columnas = [
      "Nombre", "Primera ApariciÃ³n", "Saga", "Arco", "Estado", "Origen", "Raza", "Sexo",
      "Altura", "Edad", "CumpleaÃ±os", "Fruta del Diablo", "Haki", "Recompensa", "AfiliaciÃ³n", "OcupaciÃ³n"
    ];

    let personajes = [];
    let personajeActual = null;

    // === FUNCIONES DE UTILIDAD ===
    function normalizarTexto(txt) {
      return txt ? txt.normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim().toLowerCase() : "";
    }

    function limpiarNumero(val) {
      return parseFloat(
        String(val)
          .replace(/[^\d.,-]/g, '')
          .replace(/\./g, '')
          .replace(',', '.')
      );
    }

    function crearFormulario() {
      const form = document.getElementById('form-datos');
      form.innerHTML = "";
      columnas.forEach((col, idx) => {
        const div = document.createElement('div');
        div.className = "campo-dato";
        div.innerHTML = `
          <label>${col}</label>
          <input type="text" id="campo-${idx}" data-index="${idx}" autocomplete="off">
          <span class="flecha-indicador" id="flecha-${idx}"></span>
        `;
        form.appendChild(div);
      });
    }

    function mostrarPersonaje() {
      const div = document.getElementById('personaje-actual');
      div.innerHTML = `<h2>${personajeActual[0]}</h2>`;
    }

    function comprobarDatos() {
      let aciertos = 0;
      const mensaje = document.getElementById('mensaje-final');
      mensaje.textContent = "";

      columnas.forEach((col, idx) => {
        const campo = document.getElementById(`campo-${idx}`);
        const flecha = document.getElementById(`flecha-${idx}`);
        const valorCorrecto = personajeActual[idx] || "";
        const valorJugador = campo.value.trim();

        campo.classList.remove("correcto", "incorrecto");
        flecha.textContent = "";

        // Si ya es correcto y bloqueado, saltar
        if (campo.disabled) {
          aciertos++;
          return;
        }

        let clase = "incorrecto";
        let correcto = false;

        // ComparaciÃ³n textual
        if (![1,8,9,10,13].includes(idx)) {
          if (normalizarTexto(valorCorrecto) === normalizarTexto(valorJugador)) {
            clase = "correcto";
            correcto = true;
          }
        } else {
          // NumÃ©ricos o fechas
          if (idx === 10) { // CumpleaÃ±os tipo "7 julio"
            if (normalizarTexto(valorCorrecto) === normalizarTexto(valorJugador)) {
              clase = "correcto"; correcto = true;
            } else if (valorCorrecto.includes(" ") && valorJugador.includes(" ")) {
              const [dA, mA] = valorCorrecto.split(" ");
              const [dJ, mJ] = valorJugador.split(" ");
              const meses = ["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];
              const fA = new Date(2025, meses.indexOf(mA), parseInt(dA));
              const fJ = new Date(2025, meses.indexOf(mJ), parseInt(dJ));
              if (fJ > fA) flecha.innerHTML = '<span class="flecha-down">â†“</span>';
              else if (fJ < fA) flecha.innerHTML = '<span class="flecha-up">â†‘</span>';
            }
          } else {
            const nA = limpiarNumero(valorCorrecto);
            const nJ = limpiarNumero(valorJugador);
            if (!isNaN(nA) && !isNaN(nJ)) {
              if (nA === nJ) { clase = "correcto"; correcto = true; }
              else if (nJ > nA) flecha.innerHTML = '<span class="flecha-down">â†“</span>';
              else if (nJ < nA) flecha.innerHTML = '<span class="flecha-up">â†‘</span>';
            }
          }
        }

        campo.classList.add(clase);
        if (correcto) {
          campo.disabled = true;
          aciertos++;
        }
      });

      if (aciertos === columnas.length) {
        mensaje.innerHTML = `<span>Â¡Perfecto! Has completado todos los datos de ${personajeActual[0]} ðŸŽ‰</span>`;
      }
    }

    function nuevoPersonaje() {
      personajeActual = personajes[Math.floor(Math.random() * personajes.length)];
      crearFormulario();
      mostrarPersonaje();
      document.getElementById('mensaje-final').textContent = "";
    }

    // === CARGAR DATOS DE SHEETS ===
    async function cargarDatos() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/${sheetName}?key=${apiKey}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        if (data && data.values) {
          personajes = data.values.slice(1).filter(p => p[0]);
          nuevoPersonaje();
        } else {
          alert("Error al cargar los datos.");
        }
      } catch (err) {
        console.error(err);
        alert("Error al cargar personajes.");
      }
    }

    // === EVENTOS ===
    document.addEventListener('DOMContentLoaded', () => {
      cargarDatos();
      document.getElementById('btn-comprobar').addEventListener('click', comprobarDatos);
      document.getElementById('btn-nuevo').addEventListener('click', nuevoPersonaje);
    });
  </script>
</body>
</html>

