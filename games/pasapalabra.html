<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasapalabra - One Piece</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/common.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #0a1929 0%, #1e3a5f 50%, #0a1929 100%);
            min-height: 100vh; color: #fff; padding: 2rem;
        }
        .title-font { font-family: 'Bangers', cursive; letter-spacing: 2px; }
        .rosco {
            width: 500px; height: 500px;
            position: relative; margin: 0 auto 2rem;
        }
        .letter-circle {
            position: absolute;
            width: 60px; height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            display: flex; align-items: center;
            justify-content: center;
            font-size: 1.5rem; font-weight: 800;
            color: #1a1a2e;
            border: 4px solid #e5e7eb;
        }
        .letter-circle.active {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-color: #f59e0b; color: white;
            animation: pulse 1s infinite;
        }
        .letter-circle.correct {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981; color: white;
        }
        .letter-circle.incorrect {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-color: #ef4444; color: white;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .question-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px; padding: 2rem;
            max-width: 700px; margin: 0 auto;
            color: #1a1a2e;
        }
        .input-field {
            width: 100%; padding: 1rem;
            border-radius: 10px; border: 2px solid #e5e7eb;
            font-size: 1.1rem; margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div style="max-width: 1200px; margin: 0 auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
            <a href="../index.html" style="padding: 0.75rem 1.5rem; border-radius: 10px; font-weight: 600; border: 2px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.05); color: white; text-decoration: none; display: inline-block;">← Volver</a>
            <h1 class="title-font" style="font-size: 2.5rem; background: linear-gradient(to right, #3b82f6, #1d4ed8); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">PASAPALABRA</h1>
            <div style="background: rgba(255, 255, 255, 0.95); padding: 1.5rem 2rem; border-radius: 15px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                <p style="font-size: 1.1rem; color: #1a1a2e; margin-bottom: 0.5rem; font-weight: 600;">Aciertos</p>
                <p id="score" style="font-size: 3rem; font-weight: 800; color: #3b82f6;">0/26</p>
            </div>
        </div>
        
        <div id="app">Cargando...</div>
    </div>

    <script>
        let words = [];
        let currentIndex = 0;
        let answers = {};
        let skipped = [];

        fetch('../pasapalabra.json')
            .then(r => r.json())
            .then(data => {
                words = data;
                renderGame();
            });

        function handleAnswer(action) {
            const input = document.getElementById('answerInput');
            const answer = input.value.trim();
            const current = words[currentIndex];

            if (action === 'pass') {
                if (!answers[current.letter]) {
                    skipped.push(currentIndex);
                }
                nextQuestion();
            } else if (action === 'answer') {
                if (answer.toLowerCase() === current.answer.toLowerCase()) {
                    answers[current.letter] = { correct: true, answer };
                } else {
                    answers[current.letter] = { correct: false, answer };
                }
                nextQuestion();
            }
        }

        function nextQuestion() {
            let tries = 0;
            do {
                currentIndex = (currentIndex + 1) % words.length;
                tries++;
            } while (answers[words[currentIndex].letter] && tries < words.length);

            if (tries >= words.length) {
                endGame();
            } else {
                renderGame();
            }
        }

        function endGame() {
            const correct = Object.values(answers).filter(a => a.correct).length;
            document.getElementById('score').textContent = `${correct}/26`;
            
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="question-card" style="text-align: center;">
                    <h2 style="font-size: 3rem; margin-bottom: 2rem; color: #3b82f6;">¡Juego Terminado!</h2>
                    <p style="font-size: 2rem; margin-bottom: 2rem;">
                        Resultado: <strong>${correct}/26</strong>
                    </p>
                    <button style="padding: 1.25rem 3rem; border-radius: 15px; font-weight: 700; cursor: pointer; border: none; background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; font-size: 1.3rem; width: 100%;" onclick="location.reload()">
                        Jugar de nuevo
                    </button>
                </div>
            `;
        }

        function renderGame() {
            const current = words[currentIndex];
            const correct = Object.values(answers).filter(a => a.correct).length;
            document.getElementById('score').textContent = `${correct}/26`;

            const app = document.getElementById('app');
            
            const roscoHTML = words.map((word, idx) => {
                const angle = (idx * 360 / words.length) - 90;
                const x = 220 + 180 * Math.cos(angle * Math.PI / 180);
                const y = 220 + 180 * Math.sin(angle * Math.PI / 180);
                
                let className = 'letter-circle';
                if (idx === currentIndex) className += ' active';
                else if (answers[word.letter]?.correct) className += ' correct';
                else if (answers[word.letter]?.correct === false) className += ' incorrect';
                
                return `<div class="${className}" style="left: ${x}px; top: ${y}px;">${word.letter}</div>`;
            }).join('');

            app.innerHTML = `
                <div class="rosco">
                    ${roscoHTML}
                </div>

                <div class="question-card">
                    <h3 style="font-size: 1.75rem; margin-bottom: 1rem;">
                        Letra: <span style="color: #3b82f6;">${current.letter}</span>
                    </h3>
                    <p style="font-size: 1.25rem; margin-bottom: 1.5rem; line-height: 1.5;">
                        ${current.definition}
                    </p>
                    <input
                        type="text"
                        id="answerInput"
                        class="input-field"
                        placeholder="Escribe tu respuesta..."
                        onkeypress="if(event.key==='Enter') handleAnswer('answer')"
                        autofocus
                    >
                    <div style="display: flex; gap: 1rem;">
                        <button style="padding: 1rem 2rem; border-radius: 10px; font-weight: 600; border: 2px solid #3b82f6; background: white; color: #3b82f6; font-size: 1.1rem; cursor: pointer; flex: 1;" onclick="handleAnswer('pass')">
                            Pasar
                        </button>
                        <button style="padding: 1rem 2rem; border-radius: 10px; font-weight: 600; border: none; background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; font-size: 1.1rem; cursor: pointer; flex: 2;" onclick="handleAnswer('answer')">
                            Responder
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('answerInput')?.focus();
        }
    </script>
</body>
</html>
